<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2023.03.27 -->
        <title>Understanding and Manipulating Data in Waymax - Waymax documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Waymax  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">Waymax  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/waymax/agents/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.agents</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/agents/actor_core/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.agents.actor_core</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/agents/agent_builder/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.agents.agent_builder</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/agents/constant_speed/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.agents.constant_speed</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/agents/expert/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.agents.expert</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/agents/sim_agent/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.agents.sim_agent</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/agents/waypoint_following_agent/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.agents.waypoint_following_agent</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/waymax/dataloader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.dataloader</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/dataloader/dataloader_utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.dataloader.dataloader_utils</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/dataloader/womd_dataloader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.dataloader.womd_dataloader</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/dataloader/womd_factories/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.dataloader.womd_factories</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/dataloader/womd_factories_internal/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.dataloader.womd_factories_internal</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/dataloader/womd_utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.dataloader.womd_utils</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/waymax/datatypes/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/datatypes/action/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes.action</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/datatypes/array/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes.array</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/datatypes/constant/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes.constant</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/datatypes/object_state/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes.object_state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/datatypes/observation/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes.observation</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/datatypes/operations/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes.operations</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/datatypes/roadgraph/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes.roadgraph</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/datatypes/route/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes.route</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/datatypes/simulator_state/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes.simulator_state</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/datatypes/traffic_lights/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.datatypes.traffic_lights</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/waymax/env/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.env</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../autoapi/waymax/env/wrappers/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.env.wrappers</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/waymax/env/wrappers/brax_wrapper/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.env.wrappers.brax_wrapper</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/waymax/env/wrappers/dm_env_wrapper/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.env.wrappers.dm_env_wrapper</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/env/abstract_environment/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.env.abstract_environment</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/env/base_environment/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.env.base_environment</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/env/errors/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.env.errors</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/env/planning_agent_environment/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.env.planning_agent_environment</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/env/rollout/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.env.rollout</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/env/typedefs/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.env.typedefs</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/waymax/metrics/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.metrics</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/metrics/abstract_metric/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.metrics.abstract_metric</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/metrics/comfort/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.metrics.comfort</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/metrics/imitation/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.metrics.imitation</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/metrics/metric_factory/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.metrics.metric_factory</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/metrics/overlap/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.metrics.overlap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/metrics/roadgraph/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.metrics.roadgraph</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/metrics/route/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.metrics.route</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/waymax/rewards/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.rewards</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/rewards/abstract_reward_function/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.rewards.abstract_reward_function</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/rewards/linear_combination_reward/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.rewards.linear_combination_reward</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/waymax/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.utils</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/utils/geometry/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.utils.geometry</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/utils/test_utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.utils.test_utils</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/waymax/visualization/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.visualization</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/visualization/color/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.visualization.color</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/visualization/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.visualization.utils</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/waymax/visualization/viz/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.visualization.viz</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/waymax/config/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waymax.config</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Further Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../py-modindex.html">Module Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="understanding-and-manipulating-data-in-waymax">
<h1>Understanding and Manipulating Data in Waymax<a class="headerlink" href="#understanding-and-manipulating-data-in-waymax" title="Permalink to this heading">#</a></h1>
<p>This tutorial covers data structures in Waymax.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">jnp</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">from</span> <span class="nn">waymax</span> <span class="kn">import</span> <span class="n">config</span> <span class="k">as</span> <span class="n">_config</span>
<span class="kn">from</span> <span class="nn">waymax</span> <span class="kn">import</span> <span class="n">dataloader</span>
<span class="kn">from</span> <span class="nn">waymax</span> <span class="kn">import</span> <span class="n">datatypes</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load example data.</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">_config</span><span class="o">.</span><span class="n">WOD_1_1_0_VALIDATION</span><span class="p">,</span> <span class="n">max_num_objects</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="n">data_iter</span> <span class="o">=</span> <span class="n">dataloader</span><span class="o">.</span><span class="n">simulator_state_generator</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<span class="n">scenario</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">data_iter</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="jax-based-data-structures">
<h2>JAX-based data structures<a class="headerlink" href="#jax-based-data-structures" title="Permalink to this heading">#</a></h2>
<p>The key property with all data structures in Waymax is that all data is <em>immutable</em>. This is a design decision that is inherited from JAX and enables code written using Waymax to be compatible with the powerful functional transforms in JAX, such as <code class="docutils literal notranslate"><span class="pre">jit</span></code>, <code class="docutils literal notranslate"><span class="pre">vmap</span></code>, etc. While efficiency may be a concern with immutable data structures, wrapping your function in <code class="docutils literal notranslate"><span class="pre">jax.jit</span></code> will allow JAX to optimize and replace your operations with in-place operations wherever possible, avoiding the need for excessive data copying.</p>
<p>Additionally, all datastructures in Waymax are implemented as dataclasses. This allows convenient named access to fields, and allows simple nesting of data structures that is easy to manipulate with tree-based operations (such as those in <code class="docutils literal notranslate"><span class="pre">jax.tree_util</span></code>).</p>
<p>The first example we will cover is the <code class="docutils literal notranslate"><span class="pre">datatypes.Trajectory</span></code> data structure, which holds the pose information for all objects. The scenario that we loaded contains a trajectory containing the logged behavior for all agents under the <code class="docutils literal notranslate"><span class="pre">scenario.log_trajectory</span></code> attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">log_trajectory</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">log_trajectory</span>

<span class="c1"># Number of objects stored in this trajectory.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of objects:&#39;</span><span class="p">,</span> <span class="n">log_trajectory</span><span class="o">.</span><span class="n">num_objects</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of timesteps:&#39;</span><span class="p">,</span> <span class="n">log_trajectory</span><span class="o">.</span><span class="n">num_timesteps</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trajectory shape (num_objects, num_timesteps):&#39;</span><span class="p">,</span> <span class="n">log_trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XYZ positions (num_objects, num_timesteps, 3):&#39;</span><span class="p">,</span> <span class="n">log_trajectory</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XY velocities (num_objects, num_timesteps, 2):&#39;</span><span class="p">,</span> <span class="n">log_trajectory</span><span class="o">.</span><span class="n">vel_xy</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yaw (num_objects, num_timesteps):&#39;</span><span class="p">,</span> <span class="n">log_trajectory</span><span class="o">.</span><span class="n">yaw</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">datatypes</span></code> module contains some helper methods that automatically map over datastructures. We can use <code class="docutils literal notranslate"><span class="pre">datatypes.dynamic_slice</span></code> to select out the trajectory belonging to a particular object or at a particular timestep. These operations, as with all JAX operations, will return new copies of the object they are modifying.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Slice by time. Select the trajectory at timestep 23.</span>
<span class="n">traj_t23</span> <span class="o">=</span> <span class="n">datatypes</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">log_trajectory</span><span class="p">,</span> <span class="n">start_index</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">slice_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XYZ positions (num_objects, 1, 3):&#39;</span><span class="p">,</span> <span class="n">traj_t23</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Slice by object. Select the trajectory for object 15.</span>
<span class="n">traj_obj15</span> <span class="o">=</span> <span class="n">datatypes</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">log_trajectory</span><span class="p">,</span> <span class="n">start_index</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">slice_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XYZ positions (1, num_timesteps, 3):&#39;</span><span class="p">,</span> <span class="n">traj_obj15</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Of course, JAX functions from the core library also work on Waymax data structures. The <code class="docutils literal notranslate"><span class="pre">tree_map</span></code> function is particularly useful for working with dataclasses, and will apply a single function to all fields in the data structure (recursively if there are nested data structures).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">max_along_time</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
  <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">max_trajectory</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree_util</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span><span class="n">max_along_time</span><span class="p">,</span> <span class="n">log_trajectory</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;XYZ positions (num_objects, 1, 3):&#39;</span><span class="p">,</span> <span class="n">max_trajectory</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To modify the values of the data structure, we can use <code class="docutils literal notranslate"><span class="pre">dataclasses.replace</span></code> to replace entire fields, and <code class="docutils literal notranslate"><span class="pre">Array.at[idx].set(value)</span></code> to selectively modify individual values. For example, to set the all yaws for object 1 to zero, we can use the following code snippet:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">zeroed_traj</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="n">log_trajectory</span><span class="p">,</span> 
    <span class="n">yaw</span><span class="o">=</span><span class="n">log_trajectory</span><span class="o">.</span><span class="n">yaw</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Should be the original values.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yaws for object 0, timesteps 0 to 5:&#39;</span><span class="p">,</span> <span class="n">zeroed_traj</span><span class="o">.</span><span class="n">yaw</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>

<span class="c1"># Should be now set to 0.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yaws for object 1, timesteps 0 to 5:&#39;</span><span class="p">,</span> <span class="n">zeroed_traj</span><span class="o">.</span><span class="n">yaw</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="other-important-data-structures">
<h1>Other important data structures<a class="headerlink" href="#other-important-data-structures" title="Permalink to this heading">#</a></h1>
<p>We will now cover the remaining important data structures that are stored in a scenario.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">datatypes.RoadgraphPoints</span></code> data structure holds all static information regarding the road and environment. This includes all lanes markers, road edges, stop signs, speed bumps, and crosswalks.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code> attributes define the spatial coordinates of the points.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> attribute is an integer that defines what type of point (lane, edge, stop sign, etc.) the point is. See <code class="docutils literal notranslate"><span class="pre">roadgraph_samples/type</span></code> of the <a class="reference external" href="https://waymo.com/open/data/motion/tfexample">Waymo Open Motion Dataset</a> for definitions of which value corresponds to what type of point.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">dir_x</span></code> and <code class="docutils literal notranslate"><span class="pre">dir_y</span></code> attributes define the orientation of the points. Lane points will orient in the forward direction of the lane. Edge points are oriented such that the inside of the road is always on the port side (left if facing forward) of the point.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">id</span></code> field is a unique identifier for each contiguous lane. Lanes end if there is an intersection or reach the edge of the map.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the roadgraph, with colors corresponding to the road type.</span>
<span class="n">rg_points</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">roadgraph_points</span>

<span class="n">where_valid</span> <span class="o">=</span> <span class="n">rg_points</span><span class="o">.</span><span class="n">valid</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rg_points</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">where_valid</span><span class="p">],</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">rg_points</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">where_valid</span><span class="p">],</span>
    <span class="n">s</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">rg_points</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">where_valid</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">datatypes.TrafficLights</span></code> structure holds time-varying information regarding the color and position of the traffic lights.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code> attributes define the spatial location of the light.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">state</span></code> attribute defines what color the light is at a particular instance in time.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">lane_ids</span></code> attribute tells what lanes the traffic light is controlling. These can be cross-referenced with the <code class="docutils literal notranslate"><span class="pre">RoadgraphPoints.ids</span></code> field.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">traffic_lights</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">log_traffic_light</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Traffic Light States (num_lights, num_timesteps):&#39;</span><span class="p">,</span> <span class="n">traffic_lights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">datatypes.ObjectMetadata</span></code> holds</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">object_types</span></code> attribute defines whether the object is a vehicle, pedestrian, or cyclist.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ids</span></code> attribute assigns a unique ID to each object.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">is_sdc</span></code> attribute defines whether the object is the ego-vehicle (or self-driving car).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">is_modeled</span></code> attribute marks whether the object’s behavior is meant to be predicted as part of the Waymo Open Motion dataset.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">object_metadata</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All object IDS:&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>

<span class="c1"># Color-code object trajectory by whether it is the SDC or not.</span>
<span class="c1"># The SDC trajectory in the center is shown in blue, and all other trajectories</span>
<span class="c1"># are shown in red.</span>
<span class="n">flat_trajectory</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">tree_util</span><span class="o">.</span><span class="n">tree_map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">log_trajectory</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">log_trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_sdc</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">where_valid</span> <span class="o">=</span> <span class="n">flat_trajectory</span><span class="o">.</span><span class="n">valid</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
  <span class="n">x</span><span class="o">=</span><span class="n">flat_trajectory</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">where_valid</span><span class="p">],</span>
  <span class="n">y</span><span class="o">=</span><span class="n">flat_trajectory</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">where_valid</span><span class="p">],</span>
  <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
  <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">where_valid</span><span class="p">],</span>
  <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, The Waymax Authors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Understanding and Manipulating Data in Waymax</a><ul>
<li><a class="reference internal" href="#jax-based-data-structures">JAX-based data structures</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-important-data-structures">Other important data structures</a></li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    </body>
</html>